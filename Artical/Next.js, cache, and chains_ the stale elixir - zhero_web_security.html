<!DOCTYPE html>
<!-- saved from url=(0092)https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir -->
<html lang="en" class=" js "><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <!-- begin SEO --><title>Next.js, cache, and chains: the stale elixir - zhero_web_security</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="zhero_web_security"><meta property="og:title" content="Next.js, cache, and chains: the stale elixir"><link rel="canonical" href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir"><meta property="og:url" content="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir"><meta property="og:description" content=""><meta property="og:type" content="article"><meta property="article:published_time" content="2025-01-21T00:00:00-08:00"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "Person", "name" : "zhero web security", "url" : "https://zhero-web-sec.github.io", "sameAs" : null } </script> <!-- end SEO --><link href="https://zhero-web-sec.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="zhero_web_security Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/main.css"><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --><link rel="apple-touch-icon" sizes="57x57" href="https://zhero-web-sec.github.io/images/apple-touch-icon-57x57.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="60x60" href="https://zhero-web-sec.github.io/images/apple-touch-icon-60x60.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="72x72" href="https://zhero-web-sec.github.io/images/apple-touch-icon-72x72.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="76x76" href="https://zhero-web-sec.github.io/images/apple-touch-icon-76x76.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="114x114" href="https://zhero-web-sec.github.io/images/apple-touch-icon-114x114.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="120x120" href="https://zhero-web-sec.github.io/images/apple-touch-icon-120x120.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="144x144" href="https://zhero-web-sec.github.io/images/apple-touch-icon-144x144.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="152x152" href="https://zhero-web-sec.github.io/images/apple-touch-icon-152x152.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="180x180" href="https://zhero-web-sec.github.io/images/apple-touch-icon-180x180.png?v=M44lzPylqQ"><link rel="icon" type="image/png" href="https://zhero-web-sec.github.io/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32"><link rel="icon" type="image/png" href="https://zhero-web-sec.github.io/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192"><link rel="icon" type="image/png" href="https://zhero-web-sec.github.io/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96"><link rel="icon" type="image/png" href="https://zhero-web-sec.github.io/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16"><link rel="manifest" href="https://zhero-web-sec.github.io/images/manifest.json?v=M44lzPylqQ"><link rel="mask-icon" href="https://zhero-web-sec.github.io/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000"><link rel="shortcut icon" href="https://zhero-web-sec.github.io/images/favicon.ico?v=M44lzPylqQ"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://zhero-web-sec.github.io/images/mstile-144x144.png?v=M44lzPylqQ"><meta name="msapplication-config" content="https://zhero-web-sec.github.io/images/browserconfig.xml?v=M44lzPylqQ"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/academicons.css"> <!-- Support for MatJax --> <script src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/polyfill.min.js.download"></script> <script id="MathJax-script" async="" src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/tex-mml-chtml.js.download"></script> <!-- end custom head snippets --><style id="fit-vids-style">.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style></head><body style="margin-bottom: 145.284px;"> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"> <button class="hidden" count="0"><div class="navicon"></div></button><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="https://zhero-web-sec.github.io/">zhero_web_security</a></li><li class="masthead__menu-item"><a href="https://zhero-web-sec.github.io/research-and-things/">Research &amp; Things</a></li><li class="masthead__menu-item"><a href="https://zhero-web-sec.github.io/writeups/">Writeups</a></li><li class="masthead__menu-item"><a href="https://zhero-web-sec.github.io/whoami/">Whoami</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div class="sidebar sticky"><div itemscope="" itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/for_esteemed_anon.png" class="author__avatar" alt="Rachid.A"></div><div class="author__content"><h3 class="author__name">Rachid.A</h3><p class="author__bio">vulnerability researcher ⚔️</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"> <!-- Font Awesome icons / Biographic information --><li class="author__desktop"><i class="fa-solid fa-location-dot icon-pad-right" aria-hidden="true"></i>/</li><li><a href="mailto:architektsolver@gmail.com"><i class="fas fa-fw fa-envelope icon-pad-right" aria-hidden="true"></i>Email</a></li><!-- Font Awesome and Academicons icons / Academic websites --> <!-- Font Awesome icons / Repositories and software development --> <!-- Font Awesome icons / Social media --><li><a href="https://twitter.com/zhero___"><i class="fab fa-fw fa-x-twitter icon-pad-right" aria-hidden="true"></i>X (formerly Twitter)</a></li></ul></div></div></div><article class="page" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Next.js, cache, and chains: the stale elixir"><meta itemprop="description" content=""><meta itemprop="datePublished" content="January 21, 2025"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Next.js, cache, and chains: the stale elixir</h1><p>Published in <i>zhero_web_security</i>, 2025</p></header><section class="page__content" itemprop="text"><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p14.png"></p><h2 id="introduction">Introduction</h2><p>Some time after publishing my previous research on Next.js, I was left with a feeling of unfinished business. That work had sparked my curiosity, and I sensed that this framework still had more secrets to unveil. So, I grabbed my pickaxe once more and delved back into the depths of its source code.</p><p>It turned out to be a good decision. The findings from this new research have had a significant impact on the ecosystem, and their application in the context of bug bounty programs has been remarkable (<em>after all, one can’t survive on love, fresh water, and code reviews alone</em>). This led to numerous reports being submitted, cumulatively amounting to a beautiful a six-figure sum in bounties.</p><p>As you’ve probably guessed, this article will focus on the highly popular Next.js — an open-source JavaScript framework based on React, developed and maintained by Vercel.</p><p>Reading my previous publication is not required to understand this one, but if you’re tempted, here it is: “<a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-cache-poisoning-a-quest-for-the-black-hole">Next.js and cache poisoning: a quest for the black hole</a>”. On the other hand, understanding caching concepts and their associated vulnerabilities is crucial, so, if you’re not familiar with these, I encourage you to check out <a href="https://portswigger.net/web-security">PortSwigger</a> or review some of my <a href="http://zhero-web-sec.github.io/writeups/">write-ups</a>.</p><h2 id="index">Index</h2><ul><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-1">Data request</a><ul><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-1-1">getStaticProps - SSG</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-1-2">getServerSideProps - SSR</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-1-3">Data fetching</a></li></ul></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-2">Internal URL parameter and pageProps</a><ul><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-2-1">Exploitation - DoS via Cache Poisoning</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-2-3">Real world exploitation (Bug Bounty)</a></li></ul></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3">CVE-2024-46982: The stale elixir</a><ul><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3-1">Exploitation - DoS via Cache Poisoning</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3-2">Exploitation - Stored XSS via Cache Poisoning</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3-3">Exploitation - Another way</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3-3-5">Exploitation - Cache deception</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-3-4">Specific cases</a></li></ul></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-4">Security Advisory</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-4-5">Disclaimer</a></li><li><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#section-5">Conclusion</a></li></ul><h2 id="section-1">Data request</h2><p>Before diving into the heart of the matter, it’s necessary to take a brief detour to understand the role of two Next.js functions that are crucial for what’s to come. These functions share an important commonality: they both transmit information to the target page.</p><h3 id="section-1-1">getStaticProps - SSG (Static Site Generation)</h3><blockquote><p>If you export a function called getStaticProps (Static Site Generation) from a page, Next.js will pre-render this page at build time using the props returned by getStaticProps. (<a href="https://nextjs.org/docs/pages/building-your-application/data-fetching/get-static-props">@documentation</a>)</p></blockquote><p>It’s quite straightforward: the function simply allows you to transmit data <strong>already available during the build process</strong> (<em>and therefore not tied to user requests</em>), which is, by its nature, meant to be <strong>publicly cached</strong>.</p><h3 id="section-1-2">getServerSideProps - SSR (Server-Side Rendering)</h3><blockquote><p>getServerSideProps is a Next.js function that can be used to fetch data and render the contents of a page at request time. (<a href="https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props">@documentation</a>)</p></blockquote><p>Unlike <code class="language-plaintext highlighter-rouge">getStaticProps</code>, <code class="language-plaintext highlighter-rouge">getServerSideProps</code> transmits data that is only available at the time of requests, based on factors such as the user’s data who made the request: cookies, headers, URL parameters, etc.</p><p>For example, the following code retrieves the request’s user-agent and passes it to the page:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export async function getServerSideProps(context: GetServerSidePropsContext) {
  const userAgent = context.req.headers['user-agent'];
  return {
    props: {
      userAgent, 
    },
  };
}
</code></pre></div></div><p>Finally, the data passed by <code class="language-plaintext highlighter-rouge">getServerSideProps</code> is in the form of a JSON object, as we will see shortly.</p><h3 id="section-1-3">Data fetching</h3><p>When using either of these functions (whether for SSG or SSR), Next.js employs specific routes for data fetching. These routes follow this pattern: <code class="language-plaintext highlighter-rouge">/_next/data/{buildID}/targeted-page.json</code>.</p><ul><li><code class="language-plaintext highlighter-rouge">buildID</code> is a unique identifier generated for each new build</li><li><code class="language-plaintext highlighter-rouge">targeted-page</code> is the name of the page for which the data is retrieved</li></ul><p>The response is a JSON object named <code class="language-plaintext highlighter-rouge">pageProps</code> containing the transmitted data:</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p1.png"> <em>Result of the previous snippet in which we pass the user-agent of the request</em></p><h2 id="section-2">Internal URL parameter and pageProps</h2><p><em>Note: this part is not not directly concerned by CVE-2024-46982.</em></p><p>In my previous research, I noticed that some internal “components” of the framework were not <em>hermetic</em> to the outside world as was the case for the various headers (<code class="language-plaintext highlighter-rouge">x-middleware-prefetch</code>, <code class="language-plaintext highlighter-rouge">x-invoke-status</code>..). These allowed an attacker to interfere with its functioning, potentially altering certain behaviors.</p><p>As I revisited the Next.js source code, I focused specifically on its internal operations, with the goal of finding ways to influence its behavior, just to see where it might lead. I came across this particularly interesting <a href="https://github.com/vercel/next.js/blob/de47568e894e9c0b41312acfa916491142c03756/packages/next/src/server/base-server.ts#L2004">piece of code</a>:</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p2.png"> <em>server/base-server.ts</em></p><p>The name of the constant as well as the comments clearly indicate its purpose: its value is a boolean that determines <strong>whether or not the request is a data request</strong> (<em>as previously defined</em>). For the request to be classified as such:</p><ol><li>Either the URL parameter <code class="language-plaintext highlighter-rouge">__nextDataReq</code> must be present in the request <strong>OR</strong> the request must contain the header <code class="language-plaintext highlighter-rouge">x-nextjs-data</code> along with a specific server configuration</li><li>It must be an SSG (Static Site Generation) request <strong>OR</strong> <code class="language-plaintext highlighter-rouge">hasServerProps</code> must return <code class="language-plaintext highlighter-rouge">true</code>, which is the case if <code class="language-plaintext highlighter-rouge">getStaticProps</code> or <code class="language-plaintext highlighter-rouge">getServerSideProps</code> is used on the page in question</li></ol><p>Thus, by sending a request to an endpoint that uses <code class="language-plaintext highlighter-rouge">getServerSideProps</code> and appending the <code class="language-plaintext highlighter-rouge">__nextDataReq</code> URL parameter, the server should return the expected JSON object instead of the HTML page, the constant being defined to <code class="language-plaintext highlighter-rouge">true</code>:</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p3.png"></p><p>And this was indeed the case. It may seem trivial and uninteresting at first glance, but not for someone who is used to exploiting poorly configured caches.</p><h3 id="section-2-1">Exploitation - DoS via Cache Poisoning</h3><p>Typically, to exploit cache poisoning, we leverage the presence of URL parameters in the cache-key. This not only prevents interference with the client’s site during testing, but more importantly, allows us to reset the cache to check <strong>whether changes in the request affect the response</strong>. This process would be impossible if the request never reached the server.</p><p>In our case, to trigger a DoS attack via cache poisoning by altering the content of different endpoints on the target site through the JSON object <code class="language-plaintext highlighter-rouge">pageProps</code>, the target site must have a caching system, and the URL parameters must <strong>not be part of the cache-key</strong>. This ensures that during the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation">content-negotiation</a> phase, the caching system <strong>doesn’t differentiate</strong> between these two requests:</p><p>A: <code class="language-plaintext highlighter-rouge">https://www.example.com</code></p><p>B: <code class="language-plaintext highlighter-rouge">https://www.example.com/?__nextDataReq=1</code></p><p>Consequently serving the response of request <code class="language-plaintext highlighter-rouge">B</code> -<em>cached by the attacker</em>- to users making request <code class="language-plaintext highlighter-rouge">A</code>. The attacker must therefore wait for the cache-duration to be reset and be the first to send their request during this brief window, ensuring that their poisoned response gets cached. Note that using a script that sends requests at regular intervals makes the process naturally easier. Nothing crazy, but the impact is there.</p><h3 id="section-2-3">Real world exploitation (Bug Bounty)</h3><p>Many sites were vulnerable, this was almost always the case when <strong>URL parameters were not included in the cache-key and the site was not hosted by Vercel</strong>. This is quite sensitive to test, because if we simply wait for the end of the cache-duration before sending our request, the content of the page will be altered, greatly impacting the user experience, which is obviously not desired by a bug bounty program. (<em>so be careful</em>)</p><p>To address this, we can check if the <code class="language-plaintext highlighter-rouge">Accept-Encoding</code> header (<em>or another header</em>) is part of the cache-key. If it is, we can send the malicious request without the <code class="language-plaintext highlighter-rouge">Accept-Encoding</code> header, allowing us to check if the site is vulnerable without impacting it.</p><p>Since <strong>this header is automatically added by browsers</strong>, “normal” users <strong>will not</strong> be served the response poisoned by the cache, the latter distinguishing between a request with and without the header.</p><p>I was able to win quite a few nice bounties via this vector, the severity being consistently <code class="language-plaintext highlighter-rouge">high</code> due to the heavily impacted availability.</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p4.png"></p><h2 id="section-3">CVE-2024-46982: The stale elixir</h2><p>It all starts with this particularly <a href="https://github.com/vercel/next.js/blob/979fedb8d42b9e42f515e9e5451b5b3c96b97d53/packages/next/src/server/base-server.ts#L1991">interesting conditional statement</a>, which, when it returns <code class="language-plaintext highlighter-rouge">true</code> considers the request to be an <code class="language-plaintext highlighter-rouge">SSG</code> (Server Static Generation, as seen previously):</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p5.png"> <em>server/base-server.ts</em></p><p>Since the data transmitted via <code class="language-plaintext highlighter-rouge">getServerSideProps</code> is <strong>dynamic</strong>, it is -<em>initially</em>[1]- not intended to be cached. This differs from SSG requests, which handle <strong>static data</strong>. Therefore, it’s no surprise how the framework manages <code class="language-plaintext highlighter-rouge">Cache-Control</code>:</p><p><strong>Default SSR Cache-Control</strong>: <code class="language-plaintext highlighter-rouge">Cache-Control: private, no-cache, no-store, max-age=0, must-revalidate</code></p><p><strong>Default SSG Cache-Control</strong>: <code class="language-plaintext highlighter-rouge">Cache-Control: s-maxage=31536000, stale-while-revalidate</code></p><p>[1] <em>I specify “initially” because Next.js nevertheless provides a way to do it for certain <a href="https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props#edge-cases">edge cases</a>.</em></p><p>With the basics laid out, let’s now go back to our piece of code, if we could have <code class="language-plaintext highlighter-rouge">true</code> in our first part of the conditional structure, the <code class="language-plaintext highlighter-rouge">isSSG</code> variable would be set to <code class="language-plaintext highlighter-rouge">true</code>, indicating to the framework that this is an <code class="language-plaintext highlighter-rouge">SSG</code> request, and as previously stated, <code class="language-plaintext highlighter-rouge">SSG</code> requests are <strong>cacheable</strong>. This would therefore allow a <code class="language-plaintext highlighter-rouge">Server Side Rendering</code> request to be passed off as a <code class="language-plaintext highlighter-rouge">Server Static Generation</code> request, <strong>forcing its caching</strong>. Interesting isn’t it?</p><p>The <code class="language-plaintext highlighter-rouge">if</code> block that interests us contains two <code class="language-plaintext highlighter-rouge">OR</code> operators, among the three conditions, one of them immediately catches the eye:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>req.headers['x-now-route-matches']
</code></pre></div></div><p>It would therefore be sufficient for the header to be present in the request to achieve our goal. While the likelihood of it being stripped from an external request is high, the test is surprisingly positive:</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p6.png"> <em>dopamine shot</em></p><p>The <code class="language-plaintext highlighter-rouge">/poc</code> endpoint here uses the <code class="language-plaintext highlighter-rouge">getServerSideProps</code> function, so a <strong>request containing SSR data</strong>, which, as a reminder, contains <strong>dynamic</strong> data and is therefore supposed -<em>as mentioned above</em>- to have the following <code class="language-plaintext highlighter-rouge">cache-control</code> :</p><p><code class="language-plaintext highlighter-rouge">private, no-cache, no-store, max-age=0, must-revalidate</code></p><p>Now that the request is considered <code class="language-plaintext highlighter-rouge">SSG</code>, <strong>caching is possible</strong> as indicated by the new <code class="language-plaintext highlighter-rouge">Cache-Control</code>:</p><p><code class="language-plaintext highlighter-rouge">s-maxage=1, stale-while-revalidate</code></p><p><strong>s-maxage</strong></p><p>The <code class="language-plaintext highlighter-rouge">s-maxage</code> directive specifies how long a response <strong>can be reused by a shared cache before it is considered stale</strong> and requires a new request to the origin server. In our case, this duration is set to <code class="language-plaintext highlighter-rouge">1</code> second.</p><p><strong>stale-while-revalidate</strong></p><p><code class="language-plaintext highlighter-rouge">stale-while-revalidate</code> is a directive that tells the cache that <strong>it can reuse a stale response while it revalidates one</strong>. This means that once the end of the <code class="language-plaintext highlighter-rouge">max-age</code> is reached the cache is <strong>allowed to use the stale response</strong>. I specify that a duration can be specified to the <code class="language-plaintext highlighter-rouge">stale-while-revalidate</code> directive indicating the number of seconds during which the cache can use the stale response (<em>which is not the case here</em>).</p><p>From <a href="https://www.rfc-editor.org/rfc/rfc5861.txt">RFC 5861</a>:</p><blockquote><p>The stale-while-revalidate HTTP Cache-Control extension allows a cache to immediately return a stale response while it revalidates it in the background, thereby hiding latency (both in the network and on the server) from clients.</p></blockquote><p>Ok, so caching is possible and as is customary when a CP is feasible: whatever its duration, a simple script automating the sending of poisoned requests at small intervals is sufficient to “stabilize” its poisoning.</p><h3 id="section-3-1">Exploitation - DoS via Cache Poisoning</h3><p>Now that we can cache a request containing <code class="language-plaintext highlighter-rouge">SSR</code> data, we need to exploit it and it’s time to bring out the <code class="language-plaintext highlighter-rouge">__nextDataReq</code> card.</p><p>By combining in the request:</p><ol><li>The internal URL parameter <code class="language-plaintext highlighter-rouge">__nextDataReq</code> to make it a <strong>data request</strong></li><li>The header <code class="language-plaintext highlighter-rouge">x-now-route-matches</code> to make it pass for an <code class="language-plaintext highlighter-rouge">SSG</code> thereby changing the <code class="language-plaintext highlighter-rouge">Cache-Control</code></li></ol><p>It is possible to cache the JSON object <code class="language-plaintext highlighter-rouge">pageProps</code> on the target endpoint <strong>altering the content of any page</strong> (<em>provided it uses one of the two next.js data functions</em>);</p><p>Normal request to the <code class="language-plaintext highlighter-rouge">/poc</code> endpoint: <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p7.png"></p><p>Request to the <code class="language-plaintext highlighter-rouge">/poc</code> endpoint by adding the <code class="language-plaintext highlighter-rouge">__nextDataReq</code> parameter: <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p8.png"></p><p>Request to the <code class="language-plaintext highlighter-rouge">/poc</code> endpoint by adding the <code class="language-plaintext highlighter-rouge">__nextDataReq</code> parameter and the <code class="language-plaintext highlighter-rouge">x-now-route-matches</code> header: <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p9.png"></p><p>And now when I access the <code class="language-plaintext highlighter-rouge">/poc</code> endpoint without adding any URL parameter or anything: <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p10.png"> <em>b o o m</em></p><p><strong>The cache is poisoned</strong>, and the “JSON” object is served instead of the page content. We get a nice DoS that greatly impacts <code class="language-plaintext highlighter-rouge">availability</code>, but it doesn’t stop there.</p><p>Any element that can be added to the request that has a disruptive effect on the response may be force-cached: It is also possible to get a DoS by exploiting the <code class="language-plaintext highlighter-rouge">x-now-route-matches</code> header by coupling it with other headers altering the behavior of the framework, with, for example, <code class="language-plaintext highlighter-rouge">x-invoke-status</code> (<em>subject of my <a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-cache-poisoning-a-quest-for-the-black-hole">previous research</a></em>), note however that it has been fixed in version <a href="https://github.com/vercel/next.js/commit/61ee393fb4cdf10e8b3dd1eca54c31360a73c559">14.2.7</a>.</p><h3 id="section-3-2">Exploitation - Stored XSS via Cache Poisoning</h3><p>Now, the sharpest among you are surely wondering: since we’re now accessing the “normal” page without artificially modifying it, what about the <code class="language-plaintext highlighter-rouge">content-type</code>? It should no longer be a <code class="language-plaintext highlighter-rouge">application/json</code> response.. Looking at the poisoned response (<code class="language-plaintext highlighter-rouge">/poc</code>) in my proxy gave me a good shot of dopamine, when we directly access the poisoned endpoint (<em>without</em> <code class="language-plaintext highlighter-rouge">__nextDataReq</code>) the <code class="language-plaintext highlighter-rouge">content-type</code> is <code class="language-plaintext highlighter-rouge">text/html</code>!</p><p>This means that any value of the request (<em>initially sent by the attacker</em>) being reflected in the response is a vector for a SXSS… As explained before, developers very often use <code class="language-plaintext highlighter-rouge">getServerSideProps</code> to transmit information from the user request to the page: user-agent, CSRF token, cookies, headers, URL parameters, etc.</p><p>So for an SXSS to be possible, <strong>it only takes one element to be reflected</strong>. A quick test with the <code class="language-plaintext highlighter-rouge">/poc</code> endpoint, where the <code class="language-plaintext highlighter-rouge">user-agent</code> is reflected (<em>a common case</em>) results in the following request to poison the cache:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /poc?__nextDataReq=1 HTTP/1.1
Host: localhost:3000
User-Agent: CP TO SXSS ON NEXT.JS : &lt;img src=x onerror=alert('Palestine')&gt;
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/png,image/svg+xml,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Priority: u=0, i
x-now-route-matches: 1
</code></pre></div></div><p>Once the malicious request is sent, a nice surprise awaits us by accessing <code class="language-plaintext highlighter-rouge">/poc</code> directly via the browser: <img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p11.png"> <em>Stored XSS on Next.js</em></p><p>The payload is now cached and will be triggered -without any interaction- every time a user visits the impacted endpoint. The repercussions of such a vulnerability are catastrophic, and can allow a malicious actor to extract personal data from users and/or perform mass account takeovers.</p><p>As explained earlier, when <code class="language-plaintext highlighter-rouge">getServerSideProps</code> is used, <strong>it’s very likely</strong> that an element from the request is reflected in the response, the main reason for this function being to transmit data only available at the time of the request. During my research on various bug bounty programs, here are the elements most frequently encountered (<em>list obviously not exhaustive</em>):</p><ul><li>cookie/header value about language preferences -locale- (<em>en,fr..</em>)</li><li>session cookie/uid/anonymousId..</li><li>user-agent</li><li>CSRF header</li><li>theme/color preference</li><li>context-specific cookies for the target app</li><li>host header (unlikely but it happened)</li></ul><p>A few months ago, one of the programs I had reported a stored XSS via cache poisoning to —a large, well-known ecommerce platform—replied (<em>after paying me a nice critical bounty</em>), stating that they had implemented a fix. The fix focused on the <code class="language-plaintext highlighter-rouge">__nextDataReq</code> parameter, but as we’ll see, this was not enough to fully mitigate the bug.</p><h3 id="section-3-3">Exploitation - Another way</h3><p>Earlier, we saw that Next.js used specific routes for data fetching:</p><blockquote><p>When using either of these functions (whether for SSG or SSR), Next.js employs specific routes for data fetching. These routes follow this pattern: <code class="language-plaintext highlighter-rouge">/_next/data/{buildID}/targeted-page.json</code></p></blockquote><p>Note: <em>The</em> <code class="language-plaintext highlighter-rouge">buildId</code> <em>is returned by Next.js on pages within the script tags containing the id attribute</em> <code class="language-plaintext highlighter-rouge">__NEXT_DATA__</code></p><p>Sending a request to the <strong>data fetch route</strong> by adding the <code class="language-plaintext highlighter-rouge">x-now-route-matches</code> header leads to poisoning the target page endpoint (<code class="language-plaintext highlighter-rouge">/poc</code>):</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p12.png"></p><p>Response served by the poisoned cache when accessing <code class="language-plaintext highlighter-rouge">/poc</code>:</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p13.png"></p><p>The result being exactly the same as with the use of the internal parameter, as the request is a <strong>data request</strong> in both cases.</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p16.png" width="75%" style="display: block; margin: 0 auto"></p><h3 id="section-3-3-5">Exploitation - Cache deception</h3><p>As you may have guessed, it is also possible to exploit the <code class="language-plaintext highlighter-rouge">stale-while-revalidate</code> aspect to perform a cache-deception attack. I would probably write a separate article for this type of attack. But to make it short, I was able to exploit this type of attack (<em>BBP</em>), allowing to “revalidate” the response with the response of a victim forcing the caching of this personal information, provided -of course- that the targeted endpoint reflected user data within it.</p><h3 id="section-3-4">Specific cases</h3><p>Some edge cases may require a more complex exploit, in order to juggle between the next.js cache and the cache of a potential CDN as well as their specific configurations. I will not address these cases here, the latter requiring an article on their own, I may share more one day as well as some of my scripts that allowed me to exploit them.</p><h2 id="section-4">Security Advisory</h2><p>To be potentially affected all of the following must apply:</p><ul><li>Next.js between 13.5.1 and 14.2.9</li><li>Using pages router</li><li>Using non-dynamic server-side rendered routes e.g. <code class="language-plaintext highlighter-rouge">pages/dashboard.tsx</code> not <code class="language-plaintext highlighter-rouge">pages/blog/[slug].tsx</code></li></ul><p>The below configurations are unaffected:</p><ul><li>Deployments using only app router</li><li>Deployments on Vercel are not affected</li></ul><p><a href="https://github.com/advisories/GHSA-gp8f-8m3g-qvj9">https://github.com/advisories/GHSA-gp8f-8m3g-qvj9</a></p><p><a href="https://github.com/vercel/next.js/security/advisories/GHSA-gp8f-8m3g-qvj9">https://github.com/vercel/next.js/security/advisories/GHSA-gp8f-8m3g-qvj9</a></p><p><strong>Important clarification:</strong></p><p>The part concerning <code class="language-plaintext highlighter-rouge">__nextDataReq</code> is not affected by the CVE (<em>and is therefore not fixed</em>).</p><h2 id="section-4-5">Disclaimer</h2><p>Unlike classic cache-poisoning attacks, using a cache-buster is very rarely possible (the poisoned cache being -<em>first and foremost</em>- that of the framework), testing on programs must therefore be carried out with the greatest caution, the damage caused by this attack can be very significant. Take seriously what I say here, blowing up the main page of a fortune 500 with a popup alert in the middle will potentially shorten your career as a bug hunter, SR or whatever you call yourself.</p><p>For your tests, either choose an unimportant endpoint or ask the target program team for permission to continue testing.</p><h2 id="section-5">Conclusion</h2><p>The Next.js framework is currently downloaded nearly <a href="https://www.npmjs.com/package/next">6 million times weekly</a>, making it one of the most popular JavaScript frameworks today. Many sensitive platforms rely on it, meaning that vulnerabilities of this nature can have devastating consequences for both users and businesses, affecting both availability and confidentiality, as highlighted in this research.</p><p>Fortunately, the Vercel team responded quickly, implementing a fix and issuing a security advisory to inform users, urging them to apply the patch as soon as possible to mitigate the threat.</p><p>On my side, I was able to send many reports relating to these vulnerabilities, whose severity is between <code class="language-plaintext highlighter-rouge">High</code> and <code class="language-plaintext highlighter-rouge">Critical</code> depending on the possibility or not to chain the CP to a SXSS. All sectors were affected, some of which were extremely sensitive platforms: money transfer, cryptocurrency, e-commerce… Most of them have resulted in nice rewards, including several 5-digit bounties.</p><p><img src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/p15.png" width="70%" style="display: block; margin: 0 auto"> <em>some wins</em></p><p>Other articles about new research are in the pipeline and coming soon -in shaa Allah-, feel free to follow my updates on X.</p><p>Thank you for reading.</p><p>Al hamduliLlah;</p><p><em>Published in January 2025.</em></p></section><footer class="page__meta"></footer><section class="page__share"><h4 class="page__share-title">Share on</h4><a href="https://twitter.com/intent/tweet?text=https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir" class="btn btn--twitter" title="Share on Twitter"><i class="fab fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir" class="btn btn--facebook" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fab fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a></section><nav class="pagination"> <a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-cache-poisoning-a-quest-for-the-black-hole" class="pagination--pager" title="Next.js and cache poisoning: a quest for the black hole ">Previous</a> <a href="https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir#" class="pagination--pager disabled">Next</a></nav></div></article></div><div class="page__footer"><footer> <!-- start custom footer snippets --> <!-- end custom footer snippets --><div class="page__footer-copyright">© 2025 zhero web security. Powered by <a href="http://jekyllrb.com/" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div><script src="./Next.js, cache, and chains_ the stale elixir - zhero_web_security_files/main.min.js.download"></script>
</body></html>